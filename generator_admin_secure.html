<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>G√©n√©rateur de Codes RedBull GOLD (ADMIN)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --redbull-red: #FF0000;
            --redbull-dark: #1A1A2E;
            --redbull-accent: #EAEAEA;
            --redbull-blue: #0055aa;
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0d0d1a;
            color: var(--redbull-accent);
        }
        .card {
            background-color: #252540;
            border-radius: 1rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.6);
            padding: 2rem;
        }
        .btn-generate {
            background-color: #04D9FF; /* Couleur Admin */
            color: #1A1A2E;
            padding: 0.75rem 1.5rem;
            font-weight: 900;
            border-radius: 0.5rem;
            transition: all 0.2s ease-in-out;
            box-shadow: 0 4px 15px rgba(4, 217, 255, 0.4);
        }
        .btn-generate:hover:not(:disabled) {
            background-color: #00B8D9;
            box-shadow: 0 6px 20px rgba(4, 217, 255, 0.6);
            transform: translateY(-1px);
        }
        .input-style {
            background-color: #1A1A2E; 
            border-color: #3B82F6; 
            color: #E2E8F0; 
        }
        .input-style:focus {
             border-color: #04D9FF;
             box-shadow: 0 0 0 3px rgba(4, 217, 255, 0.3);
        }
        /* Style pour l'√©cran de verrouillage */
        #password-lock-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(5px);
            z-index: 20;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .lock-card {
            background-color: #1A1A2E;
            border: 3px solid var(--redbull-red);
            max-width: 400px;
            text-align: center;
        }
        .btn-unlock {
            background-color: var(--redbull-red);
            color: white;
            font-weight: 700;
            transition: background-color 0.2s;
        }
        .btn-unlock:hover {
            background-color: #E00000;
        }
        .loading-spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 4px solid #FF0000;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="min-h-screen p-4 md:p-10 flex items-center justify-center">

    <div id="password-lock-screen">
        <div class="lock-card p-8 rounded-xl shadow-2xl">
            <h2 class="text-3xl font-extrabold mb-4 text-white">üîí Acc√®s Administrateur</h2>
            <p class="text-gray-400 mb-6">Veuillez entrer le mot de passe pour d√©verrouiller le g√©n√©rateur de codes.</p>
            <input type="password" id="admin-password-input" placeholder="Mot de passe"
                   class="w-full p-3 rounded-lg border input-style mb-4 text-center">
            <button onclick="checkPassword()" id="unlock-button"
                    class="btn-unlock w-full py-3 rounded-lg text-lg">
                D√©verrouiller
            </button>
            <p id="lock-message" class="text-sm mt-3 font-bold" style="min-height: 20px; color: yellow;"></p>
        </div>
    </div>
    
    <div id="app-container" class="max-w-xl mx-auto w-full">
        
        <header class="text-center mb-8">
            <h1 class="text-3xl font-extrabold text-white leading-tight tracking-wider">
                ADMIN : <span style="color: #04D9FF;">G√©n√©rateur de Codes GOLD</span>
            </h1>
            <p class="mt-2 text-md text-gray-400">Outil de cr√©ation et suivi des abonnements clients.</p>
        </header>

        <section id="generator-card" class="card relative">
            <h2 class="text-2xl font-bold mb-6 text-center text-red-500">‚öôÔ∏è Param√®tres du Code</h2>
            
            <div class="space-y-4">
                <div>
                    <label for="duration" class="block mb-2 text-sm font-medium text-gray-400">Dur√©e de l'abonnement (Mois, ex: 3 pour 3 mois)</label>
                    <input type="number" id="duration" value="1" min="1" max="12"
                           class="w-full p-3 rounded-lg border input-style">
                </div>
                
                <div class="flex items-center">
                    <input type="checkbox" id="is-trial" class="h-5 w-5 text-red-600 bg-gray-700 border-gray-600 rounded focus:ring-red-500">
                    <label for="is-trial" class="ml-2 text-sm font-medium text-gray-400">Marquer comme Code d'Essai (7 jours, remplace la dur√©e)</label>
                </div>
                
                <div>
                    <label for="description" class="block mb-2 text-sm font-medium text-gray-400">Description (ex: "Abonnement Standard" ou "Gout Fraise")</label>
                    <input type="text" id="description" value="Abonnement Mensuel Standard"
                           class="w-full p-3 rounded-lg border input-style">
                </div>
                
                <button id="generate-button" onclick="generateAndSaveCode()" 
                        class="btn-generate w-full transition-transform transform mt-6 flex items-center justify-center">
                    <span id="button-text">G√âN√âRER ET SAUVEGARDER LE CODE</span>
                    <div id="loading-indicator" class="loading-spinner ml-3 hidden"></div>
                </button>
            </div>
            
            <div id="result-area" class="mt-6 p-4 bg-gray-700 rounded-lg text-center font-mono text-lg break-all hidden">
                </div>
            
            <div id="message-area" class="text-center text-sm mt-4 font-bold" style="min-height: 20px;"></div>
        </section>

    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, serverTimestamp, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        setLogLevel('Debug');

        // =================================================================
        // üîë VOS CONFIGURATIONS FIREBASE FINALES üîë
        // CL√âS R√âCUP√âR√âES DE LA CONSOLE FIREBASE
        // =================================================================
        const FIREBASE_CONFIG = {
            apiKey: "AIzaSyCOJzc9JW6Jb4yVbIRtSHtTSCBnXRwBVQg", 
            authDomain: "redbull-generateur.firebaseapp.com", 
            projectId: "redbull-generateur", 
            storageBucket: "redbull-generateur.firebasestorage.app", 
            messagingSenderId: "571773020357",
            appId: "1:571773020357:web:9bfa70ee5160c51f2168ac"
        };
        const ADMIN_PASSWORD = 'Adammouza777'; 
        const APP_ID = FIREBASE_CONFIG.projectId || 'redbull-gold-app'; 
        // =================================================================

        let db;
        let auth;
        let isAuthReady = false;

        const generateButton = document.getElementById('generate-button');
        const buttonText = document.getElementById('button-text');
        const loadingIndicator = document.getElementById('loading-indicator');
        const messageArea = document.getElementById('message-area');
        const resultArea = document.getElementById('result-area');
        const lockScreen = document.getElementById('password-lock-screen');
        const lockMessage = document.getElementById('lock-message');
        const passwordInput = document.getElementById('admin-password-input');

        function displayMessage(message, isError = false) {
            messageArea.textContent = message;
            messageArea.className = `text-center text-sm mt-4 font-bold ${isError ? 'text-red-500' : 'text-green-500'}`;
        }

        function generateUniqueCode(duration, isTrial) {
            const prefix = 'RBL';
            const durationPart = isTrial ? 'T07' : `M${String(duration).padStart(2, '0')}`;
            const randomPart1 = Math.random().toString(36).substring(2, 6).toUpperCase();
            const randomPart2 = Math.random().toString(36).substring(2, 6).toUpperCase();
            return `${prefix}-${durationPart}-${randomPart1}-${randomPart2}`;
        }
        
        // Logique de v√©rification du mot de passe
        window.checkPassword = function() {
            const enteredPassword = passwordInput.value.trim();
            if (enteredPassword === ADMIN_PASSWORD) {
                lockScreen.style.display = 'none';
                displayMessage("Connexion √† la base de donn√©es en cours...", false);
                passwordInput.removeEventListener('keydown', handleKeydown);
                initializeFirebase(); // Initialise Firebase UNIQUEMENT apr√®s d√©verrouillage
            } else {
                lockMessage.textContent = "Mot de passe incorrect. Veuillez r√©essayer.";
                passwordInput.value = '';
                passwordInput.focus();
            }
        }

        // Permet de soumettre avec la touche Entr√©e
        function handleKeydown(event) {
            if (event.key === 'Enter') {
                event.preventDefault(); 
                window.checkPassword();
            }
        }

        // Ajout de l'√©couteur d'√©v√©nement pour la touche Entr√©e
        passwordInput.addEventListener('keydown', handleKeydown);

        async function initializeFirebase() {
            try {
                const app = initializeApp(FIREBASE_CONFIG);
                db = getFirestore(app);
                auth = getAuth(app);
                
                // IMPORTANT : Nous nous connectons de mani√®re anonyme pour pouvoir utiliser les r√®gles
                await signInAnonymously(auth);
                isAuthReady = true;
                generateButton.disabled = false;
                displayMessage("Pr√™t √† g√©n√©rer des codes !", false);


            } catch (error) {
                console.error("Erreur lors de l'initialisation de Firebase:", error);
                // Si la connexion √©choue, c'est g√©n√©ralement √† cause d'une cl√© mal copi√©e.
                displayMessage("√âchec de la connexion. V√©rifiez vos cl√©s Firebase et votre connexion internet.", true);
                generateButton.disabled = true;
            }
        }
        
        window.generateAndSaveCode = async function() {
            if (!isAuthReady || !db) {
                 displayMessage("Base de donn√©es non initialis√©e ou en cours de connexion.", true);
                 return;
            }

            generateButton.disabled = true;
            buttonText.textContent = "G√©n√©ration...";
            loadingIndicator.classList.remove('hidden');
            messageArea.textContent = "";
            resultArea.classList.add('hidden');

            try {
                const durationInput = document.getElementById('duration');
                const isTrialCheckbox = document.getElementById('is-trial');
                const descriptionInput = document.getElementById('description');

                const isTrial = isTrialCheckbox.checked;
                const duration = isTrial ? 0 : parseInt(durationInput.value, 10);
                const description = descriptionInput.value.trim();

                const newCode = generateUniqueCode(duration, isTrial);
                // Le chemin de collection correct : /artifacts/{APP_ID}/public/data/redbull_codes
                const collectionPath = `/artifacts/${APP_ID}/public/data/redbull_codes`;
                
                const codeData = {
                    code: newCode,
                    duration: duration, 
                    isTrial: isTrial,
                    description: description,
                    isUsed: false,
                    createdAt: serverTimestamp(),
                    activatedAt: null,
                    expiresAt: null
                };

                await addDoc(collection(db, collectionPath), codeData);

                resultArea.textContent = `Code g√©n√©r√© : ${newCode}`;
                resultArea.classList.remove('hidden');
                displayMessage("Code g√©n√©r√© et sauvegard√© avec succ√®s dans la base de donn√©es publique !", false);

            } catch (error) {
                console.error("Erreur lors de la sauvegarde du code:", error);
                displayMessage(`Erreur lors de la sauvegarde: ${error.message}. V√©rifiez vos R√®gles de S√©curit√© Firestore.`, true);
            } finally {
                generateButton.disabled = false;
                buttonText.textContent = "G√âN√âRER ET SAUVEGARDER LE CODE";
                loadingIndicator.classList.add('hidden');
            }
        }

        // Initialisation de la v√©rification du mot de passe au chargement
        window.onload = function() {
            document.getElementById('unlock-button').disabled = false;
            passwordInput.focus();
        };
    </script>
</body>
</html>            background-color: #00B8D9;
            box-shadow: 0 6px 20px rgba(4, 217, 255, 0.6);
            transform: translateY(-1px);
        }
        .input-style {
            background-color: #1A1A2E; 
            border-color: #3B82F6; 
            color: #E2E8F0; 
        }
        .input-style:focus {
             border-color: #04D9FF;
             box-shadow: 0 0 0 3px rgba(4, 217, 255, 0.3);
        }
        /* Style pour l'√©cran de verrouillage */
        #password-lock-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(5px);
            z-index: 20;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .lock-card {
            background-color: #1A1A2E;
            border: 3px solid var(--redbull-red);
            max-width: 400px;
            text-align: center;
        }
        .btn-unlock {
            background-color: var(--redbull-red);
            color: white;
            font-weight: 700;
            transition: background-color 0.2s;
        }
        .btn-unlock:hover {
            background-color: #E00000;
        }
    </style>
</head>
<body class="min-h-screen p-4 md:p-10 flex items-center justify-center">

    <div id="password-lock-screen">
        <div class="lock-card p-8 rounded-xl shadow-2xl">
            <h2 class="text-3xl font-extrabold mb-4 text-white">üîí Acc√®s Administrateur</h2>
            <p class="text-gray-400 mb-6">Veuillez entrer le mot de passe pour d√©verrouiller le g√©n√©rateur de codes.</p>
            <input type="password" id="admin-password-input" placeholder="Mot de passe"
                   class="w-full p-3 rounded-lg border input-style mb-4 text-center">
            <button onclick="checkPassword()" id="unlock-button"
                    class="btn-unlock w-full py-3 rounded-lg text-lg">
                D√©verrouiller
            </button>
            <p id="lock-message" class="text-sm mt-3 font-bold" style="min-height: 20px; color: yellow;"></p>
        </div>
    </div>
    
    <div id="app-container" class="max-w-xl mx-auto w-full">
        
        <header class="text-center mb-8">
            <h1 class="text-3xl font-extrabold text-white leading-tight tracking-wider">
                ADMIN : <span style="color: #04D9FF;">G√©n√©rateur de Codes GOLD</span>
            </h1>
            <p class="mt-2 text-md text-gray-400">Outil de cr√©ation et suivi des abonnements clients.</p>
            <p id="auth-status" class="mt-4 text-sm font-bold text-green-500">Acc√®s Administrateur d√©verrouill√©.</p>
        </header>

        <section id="generator-card" class="card relative">
            <h2 class="text-2xl font-bold mb-6 text-center text-red-500">‚öôÔ∏è Param√®tres du Code</h2>
            
            <div class="space-y-4">
                <div>
                    <label for="duration" class="block mb-2 text-sm font-medium text-gray-400">Dur√©e de l'abonnement (Mois, ex: 3 pour 3 mois)</label>
                    <input type="number" id="duration" value="1" min="1" max="12"
                           class="w-full p-3 rounded-lg border input-style">
                </div>
                
                <div class="flex items-center">
                    <input type="checkbox" id="is-trial" class="h-5 w-5 text-red-600 bg-gray-700 border-gray-600 rounded focus:ring-red-500">
                    <label for="is-trial" class="ml-2 text-sm font-medium text-gray-400">Marquer comme Code d'Essai (7 jours, remplace la dur√©e)</label>
                </div>
                
                <div>
                    <label for="description" class="block mb-2 text-sm font-medium text-gray-400">Description (ex: "Abonnement Standard" ou "Gout Fraise")</label>
                    <input type="text" id="description" value="Abonnement Mensuel Standard"
                           class="w-full p-3 rounded-lg border input-style">
                </div>
                
                <button id="generate-button" onclick="generateAndSaveCode()" 
                        class="btn-generate w-full transition-transform transform mt-6 flex items-center justify-center">
                    G√âN√âRER ET SAUVEGARDER LE CODE
                </button>
            </div>
            
            <div id="result-area" class="mt-6 p-4 bg-gray-700 rounded-lg text-center font-mono text-lg break-all hidden">
                </div>
            
            <div id="message-area" class="text-center text-sm mt-4 font-bold" style="min-height: 20px;"></div>
        </section>

    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, serverTimestamp, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        setLogLevel('Debug');

        // --- CONFIGURATION DE S√âCURIT√â ---
        const ADMIN_PASSWORD = 'Adammouza777'; 
        // ---------------------------------

        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        let firebaseConfig = {};
        try {
            firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        } catch (e) {
            console.error("Erreur de parsing de la configuration Firebase:", e);
        }
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let db;
        let auth;

        const generateButton = document.getElementById('generate-button');
        const messageArea = document.getElementById('message-area');
        const resultArea = document.getElementById('result-area');
        const lockScreen = document.getElementById('password-lock-screen');
        const lockMessage = document.getElementById('lock-message');
        const passwordInput = document.getElementById('admin-password-input');

        function displayMessage(message, isError = false) {
            messageArea.textContent = message;
            messageArea.className = `text-center text-sm mt-4 font-bold ${isError ? 'text-red-500' : 'text-green-500'}`;
        }

        function generateUniqueCode(duration, isTrial) {
            const prefix = 'RBL';
            const durationPart = isTrial ? 'T07' : `M${String(duration).padStart(2, '0')}`;
            const randomPart1 = Math.random().toString(36).substring(2, 6).toUpperCase();
            const randomPart2 = Math.random().toString(36).substring(2, 6).toUpperCase();
            return `${prefix}-${durationPart}-${randomPart1}-${randomPart2}`;
        }
        
        // Logique de v√©rification du mot de passe
        window.checkPassword = function() {
            const enteredPassword = passwordInput.value.trim();
            if (enteredPassword === ADMIN_PASSWORD) {
                lockScreen.style.display = 'none';
                displayMessage("Pr√™t √† g√©n√©rer des codes !", false);
                generateButton.disabled = false;
                passwordInput.removeEventListener('keydown', handleKeydown);
            } else {
                lockMessage.textContent = "Mot de passe incorrect. Veuillez r√©essayer.";
                passwordInput.value = '';
                passwordInput.focus();
            }
        }

        // Permet de soumettre avec la touche Entr√©e
        function handleKeydown(event) {
            if (event.key === 'Enter') {
                event.preventDefault(); // Emp√™che le comportement par d√©faut (soumission de formulaire si existant)
                window.checkPassword();
            }
        }

        // Ajout de l'√©couteur d'√©v√©nement pour la touche Entr√©e
        passwordInput.addEventListener('keydown', handleKeydown);

        async function initializeFirebase() {
            try {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                     await signInAnonymously(auth);
                }

            } catch (error) {
                console.error("Erreur lors de l'initialisation de Firebase:", error);
                displayMessage("√âchec de la connexion √† la base de donn√©es. R√©essayez.", true);
                generateButton.disabled = true;
            }
        }
        
        window.generateAndSaveCode = async function() {
            if (!db) {
                 displayMessage("Base de donn√©es non initialis√©e.", true);
                 return;
            }

            generateButton.disabled = true;
            messageArea.textContent = "";
            resultArea.classList.add('hidden');

            try {
                const durationInput = document.getElementById('duration');
                const isTrialCheckbox = document.getElementById('is-trial');
                const descriptionInput = document.getElementById('description');

                const isTrial = isTrialCheckbox.checked;
                const duration = isTrial ? 0 : parseInt(durationInput.value, 10);
                const description = descriptionInput.value.trim();

                const newCode = generateUniqueCode(duration, isTrial);
                // Le g√©n√©rateur √©crit dans la collection publique, que le portail lira.
                const collectionPath = `/artifacts/${appId}/public/data/redbull_codes`;
                
                const codeData = {
                    code: newCode,
                    duration: duration, 
                    isTrial: isTrial,
                    description: description,
                    isUsed: false,
                    createdAt: serverTimestamp(),
                    activatedAt: null,
                    expiresAt: null
                };

                await addDoc(collection(db, collectionPath), codeData);

                resultArea.textContent = `Code g√©n√©r√© : ${newCode}`;
                resultArea.classList.remove('hidden');
                displayMessage("Code g√©n√©r√© et sauvegard√© avec succ√®s dans la base de donn√©es publique !", false);

            } catch (error) {
                console.error("Erreur lors de la sauvegarde du code:", error);
                displayMessage("Erreur lors de la sauvegarde. Voir la console pour les d√©tails.", true);
            } finally {
                generateButton.disabled = false;
            }
        }
        
        window.onload = initializeFirebase;
    </script>
</body>
</html>
```eof

### 2. Portail Abonn√© (Client Public)

**Fichier : `client_portal.html`**

```html:Portail Abonne Synchronise Client:client_portal.html
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ü•§ RedBull GOLD - Portail d'Activation d'Abonnement</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            --redbull-red: #FF0000;
            --redbull-dark: #1A1A2E;
            --redbull-accent: #EAEAEA;
            --redbull-blue: #0055aa;
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--redbull-dark);
            color: var(--redbull-accent);
        }
        .card {
            background-color: #252540;
            border-radius: 1rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
            padding: 2rem;
        }
        .btn-redbull {
            background-color: var(--redbull-red);
            color: white;
            padding: 0.75rem 1.5rem;
            font-weight: 700;
            border-radius: 0.5rem;
            transition: all 0.15s ease-in-out;
            box-shadow: 0 4px 15px rgba(255, 0, 0, 0.4);
        }
        .btn-redbull:hover {
            background-color: #E00000;
            box-shadow: 0 6px 20px rgba(255, 0, 0, 0.6);
            transform: translateY(-1px);
        }
        .input-style {
            background-color: #1A1A2E; 
            border-color: var(--redbull-blue); 
            color: #E2E8F0; 
        }
        .input-style:focus {
             border-color: var(--redbull-red);
             box-shadow: 0 0 0 3px rgba(255, 0, 0, 0.3);
        }
        .private-header {
            border-bottom: 3px solid var(--redbull-red);
            padding-bottom: 0.5rem;
            color: #FFD700;
        }
        .info-block {
            background-color: #1A3A5A;
            border-left: 5px solid #FFD700;
        }
        .loading-spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 4px solid #FF0000;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="min-h-screen p-4 md:p-10 flex items-center justify-center">

    <div id="app-container" class="max-w-xl mx-auto w-full">
        
        <header class="text-center mb-8">
            <h1 class="text-4xl font-extrabold text-white leading-tight tracking-wider">
                Portail <span style="color: var(--redbull-red);">Abonn√©s GOLD</span>
            </h1>
            <p class="mt-2 text-lg text-gray-400">Entre ton code pour acc√©der √† ton service d'√©nergie garanti.</p>
        </header>

        <section id="access-section" class="card">
            <h2 class="text-2xl font-bold mb-6 text-center text-red-500">üîí Activation du Code</h2>
            
            <p class="text-gray-300 mb-4">Veuillez entrer le code unique re√ßu lors de ton paiement :</p>
            
            <input type="text" id="activation-code-input" placeholder="Ex: RBL-M03-XXXX-YYYY"
                   class="w-full p-4 rounded-lg border input-style text-center font-mono text-xl tracking-wider uppercase">
            
            <button id="activate-button" onclick="checkAndActivateCode()" 
                    class="btn-redbull w-full transition-transform transform mt-6 flex items-center justify-center">
                <span id="button-text">Activer & D√©bloquer l'Acc√®s</span>
                <div id="loading-indicator" class="loading-spinner ml-3 hidden"></div>
            </button>
            
            <div id="message-area" class="text-center text-sm mt-4 font-bold" style="min-height: 20px;"></div>
        </section>

        <section id="private-content" class="card mt-8 hidden">
            <h2 class="text-3xl font-bold mb-6 private-header text-center">‚úÖ ACC√àS VALID√â !</h2>
            
            <div class="space-y-4">
                <div class="info-block p-4 rounded-lg">
                    <p class="text-sm text-gray-300">Description de l'abonnement :</p>
                    <p id="subscription-description" class="text-xl font-bold text-white">Chargement...</p>
                </div>
                
                <div class="info-block p-4 rounded-lg flex justify-between items-center">
                    <div>
                        <p class="text-sm text-gray-300">Statut / Expiration :</p>
                        <p id="expiration-status" class="text-xl font-bold text-green-400">Chargement...</p>
                    </div>
                </div>

                <h3 class="text-xl font-bold text-red-400 pt-4">üöÄ INSTRUCTIONS DE RETRAIT IMM√âDIAT</h3>
                
                <ul class="space-y-3 text-left">
                    <li class="bg-gray-700 p-3 rounded-lg flex items-center">
                        <span class="text-red-500 font-extrabold mr-3 text-2xl">1.</span> 
                        <span class="flex-1"> **Confirmer la Commande :** Envoie imm√©diatement un message au gestionnaire **[Ton Num√©ro de T√©l√©phone / Discord / etc.]** pour sp√©cifier tes go√ªts.</span>
                    </li>
                    <li class="bg-gray-700 p-3 rounded-lg flex items-center">
                        <span class="text-red-500 font-extrabold mr-3 text-2xl">2.</span> 
                        <span class="flex-1"> **Point de Retrait :** Le stock est disponible au casier **[Ton Num√©ro]** ou zone habituelle (heure de la pause).</span>
                    </li>
                    <li class="bg-gray-700 p-3 rounded-lg flex items-center">
                        <span class="text-red-500 font-extrabold mr-3 text-2xl">3.</span> 
                        <span class="flex-1"> **Code Utilis√© :** Ce code est maintenant marqu√© comme utilis√©. Tu recevras le prochain lors de ton renouvellement.</span>
                    </li>
                </ul>
            </div>
        </section>
        
        <footer class="text-center mt-6 text-xs text-gray-600">
            Propuls√© par Firebase & Gemini. S√©curit√© de code garantie.
        </footer>

    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, query, where, getDocs, updateDoc, doc, serverTimestamp, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        setLogLevel('Debug');

        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        let firebaseConfig = {};
        try {
            firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        } catch (e) {
            console.error("Erreur de parsing de la configuration Firebase:", e);
        }
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let db;
        let auth;
        let isAuthReady = false;

        const codeInput = document.getElementById('activation-code-input');
        const activateButton = document.getElementById('activate-button');
        const buttonText = document.getElementById('button-text');
        const loadingIndicator = document.getElementById('loading-indicator');
        const messageArea = document.getElementById('message-area');
        const privateContent = document.getElementById('private-content');
        const subDescription = document.getElementById('subscription-description');
        const expirationStatus = document.getElementById('expiration-status');

        function displayMessage(message, isError = false) {
            messageArea.textContent = message;
            messageArea.className = `text-center text-sm mt-4 font-bold ${isError ? 'text-red-500' : 'text-green-500'}`;
        }
        
        function formatDate(date) {
            return date.toLocaleDateString('fr-FR', {
                day: 'numeric', month: 'long', year: 'numeric'
            });
        }

        function calculateExpirationDate(data) {
            const now = new Date();
            const expires = new Date(now);
            
            if (data.isTrial) {
                expires.setDate(now.getDate() + 7);
            } else if (data.duration && data.duration > 0) {
                expires.setMonth(now.getMonth() + data.duration);
            } else {
                expires.setMonth(now.getMonth() + 1);
            }

            return expires;
        }
        
        async function initializeFirebase() {
            try {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }
                
                isAuthReady = true;

            } catch (error) {
                console.error("Erreur lors de l'initialisation de Firebase:", error);
                displayMessage("√âchec de la connexion √† la base de donn√©es. Veuillez r√©essayer.", true);
            }
        }
        
        window.checkAndActivateCode = async function() {
            if (!isAuthReady || !db) {
                displayMessage("Connexion √† la base de donn√©es en cours, veuillez patienter.", true);
                return;
            }
            
            const enteredCode = codeInput.value.toUpperCase().trim();
            if (!enteredCode) {
                displayMessage("Veuillez entrer un code.", true);
                return;
            }

            activateButton.disabled = true;
            buttonText.textContent = "V√©rification...";
            loadingIndicator.classList.remove('hidden');
            messageArea.textContent = "";

            try {
                const collectionPath = `/artifacts/${appId}/public/data/redbull_codes`;
                
                const codesQuery = query(
                    collection(db, collectionPath),
                    where('code', '==', enteredCode)
                );
                
                const querySnapshot = await getDocs(codesQuery);

                if (querySnapshot.empty) {
                    displayMessage("Code invalide ou inexistant. V√©rifiez la saisie.", true);
                    return;
                }

                const codeDoc = querySnapshot.docs[0];
                const codeData = codeDoc.data();
                
                if (codeData.isUsed) {
                    let message = "Ce code a d√©j√† √©t√© utilis√©/activ√©.";
                    if (codeData.expiresAt && codeData.activatedAt) {
                        message += ` Il a √©t√© activ√© le ${formatDate(new Date(codeData.activatedAt.toDate()))}.`;
                    }
                    displayMessage(message, true);
                    return;
                }

                const expirationDate = calculateExpirationDate(codeData);
                const formattedExpiration = formatDate(expirationDate);
                
                await updateDoc(doc(db, collectionPath, codeDoc.id), {
                    isUsed: true,
                    activatedAt: serverTimestamp(),
                    expiresAt: expirationDate.getTime(),
                    activatedBy: auth.currentUser.uid
                });
                
                const durationText = codeData.isTrial ? 'ESSAI GRATUIT (7 jours)' : `${codeData.duration} MOIS d'abonnement`;
                
                subDescription.textContent = codeData.description || `Abonnement : ${durationText}`;
                expirationStatus.textContent = `Expire le ${formattedExpiration}`;
                
                displayMessage(`Abonnement valid√© ! Acc√®s d√©bloqu√© jusqu'au ${formattedExpiration}.`);
                
                document.getElementById('access-section').classList.add('hidden');
                privateContent.classList.remove('hidden');

            } catch (error) {
                console.error("Erreur lors de l'activation du code:", error);
                displayMessage("Une erreur interne est survenue. Code non activ√©. R√©essayez.", true);
            } finally {
                activateButton.disabled = false;
                buttonText.textContent = "Activer & D√©bloquer l'Acc√®s";
                loadingIndicator.classList.add('hidden');
            }
        }
        
        window.onload = initializeFirebase;
    </script>
</body>
</html>
```eof
